apiVersion: skaffold/v4beta11
kind: Config
metadata:
  name: libmanagement
build:
  artifacts:
    - image: bookmgmtserv
      context: booksmgmtserv
      docker:
        dockerfile: Dockerfile
    - image: keycloak
      context: keycloak
      docker:
        dockerfile: Dockerfile
    - image: usermgmt
      context: usermgmt
      docker:
        dockerfile: Dockerfile
    - image: gateway
      context: gateway
      docker:
        dockerfile: Dockerfile
    - image: nextjsfrontend
      context: nextjsfrontend
      docker:
        dockerfile: Dockerfile
      sync:
        manual:
          - src: "nextjsfrontend/src/"
            dest: "app/src"
          - src: "nextjsfrontend/.gitignore"
            dest: "app/"
          - src: "nextjsfrontend/.gitignore"
            dest: "app/"
          - src: "nextjsfrontend/.dockerignore"
            dest: "app/"
          - src: "nextjsfrontend/tsconfig.json"
            dest: "app/"
          - src: "nextjsfrontend/tailwind.config.json"
            dest: "app/"
          - src: "nextjsfrontend/README.md"
            dest: "app/"
          - src: "nextjsfrontend/.env"
            dest: "app/"
    # - image: mongodatabase
    #   context: databases
    #   docker:
    #     dockerfile: mongodb-dockerfile
    # - image: postgresqldatabase
    #   context: databases
    #   docker:
    #     dockerfile: postgresql-dockerfile
  tagPolicy:
    inputDigest: {}
  local:
    concurrency: 0
manifests:
  kustomize:
    paths:
      - k8smanifests
deploy:
  kubectl:
    hooks:
      before:
        - host:
            command: ["sh", "-c", "docker compose up -d"]
